security,Add verification test for RSA.,,,
security,Add null checks for content and encryption info to not throw NPE fordocuments with null content or with no encryption requirements.,,,
security,It worked before but this change brings in the CertAuthenticatoras well as adds all kinds of sanity checks so that invalid auth combinations are rejected.,,,
security,Allow username/password to open bucket with PasswordAuthentictor,,,
security,Add tests for path normalization and prefix matching only on segment separators and use the new mechanism in SmartClientSmartServerSslTest to disable sslVerify selectively for only the test server URLs.,,,
security,Update SHA1 class to include a Java port of sha1dc[1]'s ubc_check which can detect the attack pattern used by the SHAttered[2] authors.,,,
security,We do not want to store the cert in refs/for/master@{cert} since that may lead someone looking to the ref to the incorrect conclusion that that ref exists.,,,
security,Instead of having the undocumented behavior of throwing NPE from certain methods if they are not first guarded by enabled() eliminate enabled() and return null from those methods.,,,
security,CanonicalTreeParser can detect malformed potentially malicious tree entries and sets a flag while DirCacheCheckout refuses to work with such paths.,,,
security,None of these should have been exposed to base classes. Exposes essentially the same state machine to the programmer as is exposed to the client via a ProgressMonitor using a wrapper around beginTask()/endTask().,,,
security,This change adds additional methods in ReceivePack that will allow a server to check the above conditions in order to ensure that a user is not trying to create a reference that they cannot see or that a malicious user isn't attempting to forge the SHA1 of an object that they cannot see in order to base a change off of it.,,,
security,This makes it easier to swap out authenticator implementations and yet still rely upon being able to configure at least one Authenticator instance in the JVM and program it with data obtained from outside of the user interface.,,,
security,We do need _some_ abstraction for getting passwords for encrypted keys in the API; EGit will need to provide its own implementation. sshd only asks exactly once for the password. C.f. upstream issue SSHD850.[1] So we have to work around this limitation for now.,,,
security,the security of this protocol is critically dependent on the randomness of the randomly chosen parameters such as client and,,,
security,server nonces. Consider a malicious redirect A>B: this would allow server B to harvest the user credentials for server A. ,,,
security,These are less likely to be sensitive to SHAttered[2] types of attacks as Git uses them to detect random bit flips during transfer and not for content identity.,,,
security,Weird crash in OkBuffer from okhttp 2.0 #682 ,,,
security,Hi would be possible to have a method RequestBody.string() like in the ResponseBody.string() ?,,,
security,It would help with the logging of the request being sent.,,,
security,This means that first request is made for application/json data the second one requests application/xml. ,,,
security,This is my code and I am getting an exception like this: When you connect to this host with another HTTP client which cipher suite + TLS version are used?,,,
security,SSLHandshakeExceptions are now thrown for every request until a new OkHttpClient is created java.lang.ClassNotFoundException: Didn't find class android.security.NetworkSecurityPolicy #3772 ,,,
security,There is no excepiton if I use this instead: Security.insertProviderAt(new org.conscrypt.OpenSSLProvider() 1);,,,
security,but okhttpclient use tls 1.2 to handshake not 1.3,,,
security,The API is imperfect because HttpURLConnection doesn't expose any SSL information and because HttpsURLConnection won't necessarily have a secure final request.,,,
security,The field com.squareup.okhttp.internal.spdy.SpdyConnection.spdyWriter may be accessed in parallel without proper synchronization.,,,
security,Support Certificate Pinning #173 ,,,
security,Would it be safer to protect concurrent accesses to com.squareup.okhttp.internal.DiskLruCache.size inside com.squareup.okhttp.internal.DiskLruCache.processJournal(),,,
security,Would it be safer to protect concurrent accesses to com.squareup.okhttp.internal.DiskLruCache.maxSize inside com.squareup.okhttp.internal.DiskLruCache.getMaxSize(),,,
security,This creates a new value object that captures the relevant bits of the handshake. ,,,
security,Implement SCSV for TLS fallbacks #572,,,
security,We've also tried using SSLSocketFactory.getDefault() it also segfaults.,,,
security,These are potentially private and we don't want to leak them to another host regardless of whether they're created by the calling application or by the Authenticator.,,,
security,HTTP/2 Draft 13 restricts TLS cipher suites and requires support of [TLSECDHE] with P256 [FIPS186].,,,
security,More and more apps are moving to using TLS/SSL for all of their network traffic. It would be great if such apps could configure okhttp to disallow cleartext communications to prevent accidents.,,,
security,As a result a regression (to using cleartext HTTP) in the app will not lead to sensitive data being transmitted in cleartext.,,,
security,We continue to perform only one fallback to SSLv3.,,,
security,Currently I see that OkHttp supports only sha1 hashes. There is a way to add support for sha256 too?,,,
security,Using a sha1 hash is a security issue since sha1 should not be used for signing certificates anymore so it should not for pinning sensitive data: some content requires encryption others do not.,,,
security,The request is completing successfully without any exception being thrown. It should throw an exception as described in the documentation.,,,
security,Pinning against SPKI is what Adam Langley's blog recommends to avoid misinterpretation attacks:,,,
security,Does OkHttp support authentication for SOCKS proxies as of now? I looked into the documentation (http://square.github.io/okhttp/javadoc/com/squareup/okhttp/Authenticator.html) and it looks like this is just for HTTP proxies?,,,
security,This prevents leaking requestspecific configuration (the authenticator) into shared connection configuration (the proxy authenticator).,,,
security,Yes. It'll be finished when OkHttp uses the default KeyStore or if that isn't a desirable fix the test will be changed to use the default SSLSocketFactory in which case the test will start passing.,,,
security,Problem is that calculation of sha fingerprint for the certificate during the check in CertificatePinner gives different results on Android <= 5 and Android > 5 > leads to SSLPeerUnverifiedException.,,,
security,I've added a isCleartextTrafficPermitted method to Platform which determines whether the device permits cleartext. For Android the call is delegated to NetworkSecurityPolicy. ,,,
security,Is there a planned story for persistent storage e.g. Cookies HTTP Public Key Pinning or HTTP Strict Transport Security?,,,
security,The CertificatePinner.findMatchingPins() should ignore the case because http doesn't care if the name is in uppercase or not.,,,
security,Attempting a Google login first somehow swaps the com.android.org.conscrypt.SSLParametersImpl for a com.google.android.gms.org.conscrypt.SSLParametersImpl under the hood after which attempting a PayPal login fails to load gmsSslParametersClass and leads to the crash.,,,
security,TLSv1.3 is coming. okhttp needs to be adjusted to not disable TLSv1.3 in the underlying TLS stack or to at least let the user of okhttp enable TLSv1.3 if the underlying TLS stack supports it.,,,
security,This adjusts TLS protocol selection logic to leave TLSv1.3 enabled if it's enabled in the underlying TLS stack. Prior to this change,,,
security,TLSv1.3 was disabled unless the user of okhttp explicitly enabled it via a custom ConnectionSpec.,,,
security,Exception in thread main javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target at sun.security.ssl.Alerts.getSSLException,,,
security,TrustKit is a library for Certificate Pinning implementation. Pretty similar to what you did here with CertificatePinner but with reporting capability and Network Security Configuration compatibility. ,,,
security,Not necessarily for landing testing what would be required. At minimum waiting for a final 1.0.0 release would be prudent. 5 test bugs still to resolve not yet clear if they are in okhttp main okhttp test assumptions or conscrypt.,,,
security,Added support for secure connect events.,,,
security,we try to connect with test server same certificate api look like https://one.host.com:9443/api this requets is allow maninthemiddle attack.,,,
security,We now have the problem that the Pinning is no longer working meaning a 'Man in the middle' attack is possible.,,,
security,Or at minimum a full exception and any information about your client code e.g. changes to default okhttp client including custom certs.,,,
security,If someone is using these for e.g. tests running on a CI server the logs will leak authorization tokens.,,,
security,There is a warning in the README about not using this in production but I think it would be very easy to redact values of sensitive headers (I think Authorization and ProxyAuthorization are the only ones?) just to warn that i've got an SLL error on Android 4.4 version when i update from 3.9.1 to 3.10. SslClient: new APIs for my certs vs. peer’s certs. Should accept a cert to trust.,,,
security,MockWebServer: setWantClientAuth(true) on incoming SSL sockets ,,,
security,RecordedRequest: expose the server’s handshake as a new field java.lang.ArrayIndexOutOfBoundsException: length=8192; index=8192 at com.android.okhttp.okio.Buffer.writeByte(Buffer.java:973),,,
security,Do this issue create a Security Vulnerabilities ?,,,
security,I expect that the ProxySelector default will provide the proper proxy settings and that if proxy auth is required the default authenticator will be used.,,,
security,And also the list of authentication parameters is defined to be commaseparated not whitespace separated or commawhitespaceseparated but your current regex only matches parameters that follow spaces that is also not correct.,,,
security,fix proxy https auth bug,,,
security,LoggingEventListenerTest.secureGet failing with incorrect cipher suite,,,
security,If okhttp supports h2c it will be very convenient to be compatible with both h2 and http/1.1 servers.,,,
security,We have a usecase where TLS/mTLS is handled by a sidecar component (in our case istio) and our requests need to be done using plain HTTP from applicative side (trying to call using HTTPS will make the call fail).,,,
security,okhttp 4.3.0 crash with custom X509TrustManager,,,
security,Add HTTP/2 and TLSv1.3 columns to our security providers doc,,,
security,Memory leak detection tests are broken HTTPS client auth doesn’t work,,,
security,(ssl_parse_serverhello_tlsext+262) native crash on KitKat and lower,,,
security,I am getting this exception on some devices and some requests are working and others are not working.How to fix this,,,
security,After upgrading to okhttp 3.14.0 I have an IO exception on execute when I perform the same GET request. The interceptor message indicates handshake failed.,,,
security,I'm happy to sign an ICA and I am going to work on a patch over the weekend. I'm not that familiar with the code or TLS protocol negotiation so wanted to share what I'm thinking here in case this is either expected behavior or I am completely offtrack.,,,
security,When performing TLS fallback add previous exceptions to later ones as suppressed exceptions to help when debugging negotiation issues.,,,
security,The API is imperfect because HttpURLConnection doesn't expose any SSL information and because HttpsURLConnection won't necessarily have a secure final request.,,,
security,This checks that calls into HttpConnection occur in the correct sequence.,,,
security,We don't buffer response bodies in the new API. But we should retransmit,,,
security,POST bodies when a request fails.,,,
security,This includes potential security problems (newline characters) as well as,,,
security,simple nonASCII characters including international characters and emoji.,,,
security,have hacked together a small little test,,,
security,harness to make finding these leaks easier;,,,
security,This prevents leaking requestspecific configuration (the authenticator) into shared connection configuration (the proxy authenticator).,,,
security,This optional filter can be used to allow for blocking HTTP traffic to,,,
security,certain URLs for example in order to prevent accessing sensitive,,,
security,content over HTTP instead of HTTPS.,,,
security,Support the GMS security provider when searching for the trust manager.,,,
security,One problem with that solution is that although it gives expert users a powerful way to separate response bodies it also allows normal users to accidentally leak response bodies in their interceptors.,,,
security,HTTP/2 so we don't overload non multiplexed connections.,,,
security,HTTPS since we need subjectAltNames (n.b. RFC 7540 defines as safe to use over plaintext based purely on DNS).,,,
security,Desired url host is part of the subjectAltNames for an existing connection.,,,
security,One of the DNS results for desired host match the established connection.,,,
security,HostnameVerifier is not overridden.,,,
security,ConnectionPinner accepts the existing certificate chain.,,,
security,We are able to access the SSLSocketFactory from the OkHttpClient but not the TrustManager used. Since there is no way to recover the used trust manager from the socket factory we are adding explicit accessors.,,,
security,PushObserver can be used to push serverinitiated HTTP/2 requests into an OkResponseCache,,,
not,Remove empty() factory methods on Documents.MotivationRecently a (valid) check has been added which makes surethat every Document has a valid ID. This renders theempty() factory methods useless since their usage willfaill imediately.ModificationsRemove the empty() factory methods to prevent their usageand failure at runtime.ResultPreventing incorrect API usage and removing dead methods.ChangeId: ,,,
not,Handle LOCKED in conversions.MotivationAs port for XERROR and Couchbase Server 5.0 we need to properlyhandle the LOCKED response code coming from coreio.ModificationsFirst a new battery of tests has been added to avoid regressionsand cover all the previous use cases. Then the bucket and subdochelper converters are modified to map the LOCKED status to theirbackwards compatible counterparts.ResultProperly handling the new LOCKED status code in combination withXERROR and 5.0,,,
not,Precheck connection string to avoid IOOB exceptionMotivationA community member reported an IndexOutOfBounds when working withthe cluster manager. Looking at the code it looks like the connectionstring did not contain a single host.ModificationsThe code now checks if there is at least a hostname loadable fromthe parsed connection string and if not fails with a helpfulmessage instead of IOOB.ResultBetter error diagnostics when the connection string is not correct.,,,
not,Support Builder for Merge.MotivationLike with SELECT it is important to provide a nice builder API (\"DSL\") forthe recently stabilized N1QL mutation commands.ModificationsThis changeset adds the builder API for the MERGE variant. Unit tests have been added toverify the resulting N1QL query.ResultIt is now possible to easily run merge statements using the nicebuilder API.,,,
not,Implement a Combined Configuration Provider (Binary + HTTP)This changeset provides a combined http and binary configuration provider. It isdesigned to handle bootstrap and monitoring completely autonomously furtherdecoupling it from the rest of the codebase,,,
not,Align logging,,,
not,Bring AT_PLUS in line with the latest RFC changes.MotivationThe latest RFC simplifies the proposal by reducing some of thefeature set for the first iteration. Since those concepts werenot implemented yet the actual java implementation also gotsimplified and streamlined.ModificationsMethod signatures updated and internal data structures andprocessing simplified as well.Note that the unique seqno match has been updated and is nowdone when the tokens are inserted rather than when it isprocessed. This also optimizes for the case where only everon token is passed in.ResultJava code in line with the latest RFC iteration,,,
not,Start 2.7.12 Development,,,
not,Updated spy dependency to 2.8.4SNAPSHOT.,,,
not,fix javadoc for RetryBuilderMotivationThe class javadoc for RetryBuilder is incorrect starting point shouldbe static methods anyOf allBut and any.ModificationsFixed the class javadoc.Also mentioned the behavior when errors keepoccurring past the maxAttempts allowed number of retries (a specificCannotRetryException is raised) both in class javadoc and on max andonce methods javadoc.ResultJavadoc for RetryBuilder is more accurate.,,,
not,Add support for ephemeral ejection methods.MotivationThis change adds support for the NRU and None ejection methods so itcan create ephemeral buckets properly.,,,
not,Start 2.5.6 Development,,,
not,Add new IDE support in .gitignore,,,
not,Update Config from NMVBResponses.This changeset takes an incoming \"Not My VBucket\" response from the serverdoes some conversion logic and then passes it on to the ConfigurationProvider.The config then gets parsed and stored as any other configuration comingfrom a streaming response. A test case is added to veriy that behaviour.,,,
not,Adapt to latest core changes and change View API,,,
not,Changed spy jar configuration to defaultWe changed this in spymemcached during the release so that it wouldbe added as a normal compile time dependency for users who add thespy dependency to their pom files. I changed it in the pom config butnot in the project config that we use for development.,,,
not,Long running prepared query observables may get releasedearlyMotivationLong running prepared query observable may get released early as theretry handler waits for error observable to be completed.ChangesUse http response status to detect if the query has failed and then peekfor retry in error observable. Prepared tests use travelsample bucketas it requires long running query. Prepared tests are ignored by default.ResultsLong running query observable are not released early.,,,
not,Don't increment volatile variablesIncrementing a volitile int is not thread safe since it followsthe read/modify/update pattern,,,
not,Add name and description to generated pom.MotivationThese two properties were previously added by hand but need to be partof the POM for maven central publishing.ModificationsAdded the name and description similar to the coreio implementation.Also Simon and Sergey have been formally added as developers.ResultNo more manually adding those properties by hand.,,,
not,moving flush to bucket manager,,,
not,Update Subdoc API to match RFC Modifications This changeset performs two changes:   it sets the API to committed   it update the createDocument to upsertDocument deprecating the    old one,,,
not,Add LICENSE file,,,
not,Never compress JSON in LegacyDocument.MotivationIn spymemcached the code checks if the string is JSONand if it is it skips compression so the server canunderstand it properly.ModificationsUp until now the LegacyTranscoder didn't check for thisfact and as a result did compress larger JSON docs whichwould then not be readable by the server properly.This changeset ports the (not bulletproof) JSON check fromspymemcached and adds a test case to make sure that JSON isindeed not compressed even if larger than the compressionthreshold.Resultbetter compatibility with spymemcache and making sure thatlarger JSON docs are not compressed,,,
not,Optimize queue pop to use subdocument get for valueMotivationThe bucket level queue data structure uses full document get forretrieving the front of the queue. Using a subdocument operation is muchmore efficient.ChangesUse the subdocument get for the element. The existing tests cover thiscase and pass,,,
not,Adding support for append and prepend.,,,
not,Add a toString() on N1qlQueryMotivationReturn a string when toString is called instead of Query object hashcode ChangesOverride toString in SimpleN1qlQuery and ParameterizedN1qlQuery to return query statement string,,,
not,bump latest stable version in README's pomalso added links to the forums and blog,,,
not,Rename subdoc builder doXXX methods to execute()Motivation:The original RFC method name for execution of a builder is do(). This isincompatible eg. with Java being a keyword. Most other SDKs where thisis also incompatible elected to name the method execute() instead.Since it is expected that the RFC be amended towards renaming execute()the java naming of doMutate() and doLookup() can be harmonized with theother SDKs.Modifications:doMutate() and doLookup() are now all renamed execute().Results:The execution methods of the builders are the same across SDKs where docannot be a method name.,,,
not,Fix property replacement in build process.,,,
not,Override coreio configPollFloorInterval Builder.,,,
not,Cleanup Query and add docblock for grouping.This changeset performs non behaviour changing cleanup andenhances the docblock for setGroup and setGroupLevel towarn users to not use both together since they overrideeach other.,,,
not,Temporarly disable checkstyle in buildMotivationHaving checkstyle plugin activated in gradle build but no checkstyleconfiguration yet causes the build to fail.ModificationsDisable checkstyle plugin in gradle build until a checkstyle config ischosen and put in place.ResultBuild doesn't fail due to checkstyle errors anymore,,,
not,Using raw statement to create index in testMaking sure that N1QL primary indexes are at least created on test'sbucket before testing N1QL features.,,,
not,Upgrade Spymemcached to 2.10.0. This changeset upgrades the spy dependency and also applies allneeded fixes for the upgrade (it passes the executor along to thefutures).,,,
not,Cache Bucket and AsyncBucket references.MotivationBest practice recommends that only one Cluster and one Bucketreference per bucket are opened and then reused as a singleton.In the field it has been discovered that sometimes the bucketsare not reused but rather opened on every call and just theCluster object is reused.ModificationsTo apply \"defense in depth\" if the best practices are notfollowed the Bucket and AsyncBucket objects are cashed ina CHM so when subsequent calls are incoming no new Bucketinstances are created.Lifecyclemanagement is also includes so when a bucket isclosed and then opened again this is discovered and athe references are replaced.ResultEven when the best practices are not followed this changetries to minimize the impact.,,,
not,Upgrading spymemcached to 2.8.10. Note this is a prerequisite to the fix for JCBC214.  There wasone fix at the SPY project level related to detecting failures.,,,
not,Adapting README for GA changes.,,,
not,Cache JsonBooleanTranscoder true/false values.MotivationSince only true and false can be passed in there is a very smallfinite number of possible buffers to be created.Modifcationstrue and false representations and preallocated and then reusedevery time they are needed. Result No need to create these two representations every time.,,,
not,Update signatures to latest tracing changes.,,,
not,Dont use view connections for memcachedThis changeset makes sure to only set/use the view connection whileconnected to a couchbase bucket and not to a memcached bucket.It also adds a test class with corresponding mocks to make surethe initialization works correctly and does not fail on rebalanceor shutdown as well.,,,
not,Adding a ComplexKey class and tests for querying with arrays.This changeset extends the capabilities of the ComplexKeyclass fixes a few issues and adds test cases for allsupported operations. It also adds docblocks whereappropriate,,,
not,Add query profile info to N1qlQuery resultMotivationIf query profile info is requested using a raw param the query responsecontains profile information and it is parsed if using yasjl parser. Exposethis information on N1qlQueryResult.ChangesAdd profileInfo JsonObject to N1qlQueryResult and the corresponding observable to AsyncN1qlQueryResult. Map the bytebuf emitted by QueryResponse to jsonObjectby parsing it using objectMapper. Default is an empty object. Added changes toexisting tests to include profile Info.ResultsQuery profile info should be available in N1qlResult and AsyncN1qlResultif requested.,,,
not,enriching pom and adding javadoc and sources generation.,,,
not,More membase to couchbase refactoring changesChanged some more occurences (affects javadocs and log messages)Also added/renamed VBucketCouchbaseClientTest.java which I missed.ChangeId: I9ec314dd2ac65cb904bed978710835135e2a0ac9Reviewedon: http://review.couchbase.org/12160Reviewedby: Michael Wiederhold <mike@couchbase.com>Testedby: Raghavan N. Srinivas <raghavan.srinivas@gmail.com>",,,
not,Make observe poll loop parameters tuneable.,,,
not,Don't compare vBuckets on MEMCACHE bucket reconfigs.This changeset checks the bucket type before applying vbucket checks. Thisprevents the problem of trying to compare vbuckets when there are none.,,,
not,Upgrade coreio to 1.0.1MotivationUpgrading coreio to the latest bugfix release.,,,
not,Added better debug logging on ViewNode error handling.,,,
not,Funnel all durability errors into a DurabilityException.MotivationCurrently the documentation states correctly that all durability errors whichviolate the requirement are caught and raised in the DurabilityException.This is currently only the case on one mutation method all the othersneed to follow suit.ModificationsProperly catch and collect the errors on mutation and remove observe methods.Also the BinaryTest has been renamed to KeyValueTest for clarity.ResultProper exception thrown as advertised in the docs.,,,
not,N1QL helper to build updateFor clauseMotivation:When doing an UPDATE in the set you can provide an \"updatefor\" clausethat looks like FOR variable IN path WHEN condition END. The current DSLallows to provide that as a single Expression leaving the user puzzledabout the exact syntax.Modifications:A new category of helpers is introduced in the dsl.clause package. Inthis case a UpdateForClause is provided that allows to guide the userin constructing the proper updatefor Expression.Added unit tests for the builder in UpdateDslTest.Result:User can now be guided by the API in constructing the updateFor clause.,,,
not,Rename PasswordAuthenticator to ClassicAuthenticator.Recent changes to the RFC proposed this renaming and this changesetimplements the rename accordingly.,,,
not,Fix api doc to correctly mention aboutDesignDocumentDoesNotExistExceptionChangesFix api documentation which was not correctly updated to mentionDesignDocumentDoesNotExistException added by JCBC974 in the designdocument management api(getDesignDocument removeDesignDocument publishDesignDocument),,,
not,Fixed incorrect error handling in view parsingThis should call setException because setException set erroredto true. If errored is not set then the Future won't properlythrow and exception.,,,
not,Add new operations (set/add/replace) without ttl  see JCBC284,,,
not,Fix ConcurrentModificationException in VBucketNodeLocatorMotivationIf a node needs to be removed in the VBucketNodeLocator#fillNodeEntries the previouscode could lead to a ConcurrentModificationException.ModificationsUse an iterator to safely remove it from the map.ResultNo more ConcurrentModificationException.,,,
not,Use correct path for git hooks dir and remove Simon basle from reviewers.MotivationWasting time on finding out that \"cd .git/hook\" will never work as the hook scriptsHave to be in the \".git/hooks\" dir. Simon Basle isn't responsible anymore.ModificationsAdded a simple s (\"hooks\") and removed one more complex s (Simon).ResultCommit Message script is applied correctly. Reviewers are now correct.,,,
not,More signature fixes needed,,,
not,add use index hint to query DSLMotivationThe Query team introduced a new clause to hint at which index(es) to usein a query. This comes in the form of a USE INDEX clause after the FROMclause.ModificationsAdded HintPath and HintIndexElement to represent this new clause.Introduced a new IndexReference class that wraps an escaped index nameand an optional USING GSI|VIEW suffix.Added unit tests for the HintPath.ResultsUsers can now hint at which index(es) to use. New tests pass.,,,
not,Improvide documentation in the .document package.,,,
not,Suppress unchecked warnings on completion listeners.,,,
not,Adjust checks in unit testsMotivationBecause of JsonDocument constuctor is not very verbose it is very easyto misuse it when it comes to setting expiry. Consider following twosignatures:  JsonDocument create(String id JsonObject content long cas)  JsonDocument create(String id int expiry JsonObject content)Java does not warn when small literal number used.The second point is that counter test clearly intent to assert that CASchanged on each increment/decrement. But it done is some strange way.ModificationsFor first case JsonDocument's expiry properly initialized. For thesecond case all combinations used to ensure that CAS does not matchResultMore robust unit tests and more clear intention revealing.,,,
not,Fix fts errors handling/parsing querystring highlightMotivationDuring the REVIEW phase the following problems have been identifiedwith FTS RFC that affect the implementation:  StringQuery should be QueryStringQuery  there is an additional plaintext error case: HTTP 412 when a consistency is requested but cannot be fulfilled within the timeout  highlight style is actually optional  errors is not an array but an object and when it is present hits can be nullModifications  StringQuery has been renamed to QueryStringQuery and the static factory method from string to queryString.  highlight now has several overloads that can omit the style. when used the style is actually set to new special enum SERVER_DEFAULT.  HTTP 412 case leads to a ResponseStatus.FAILURE which is now interpreted as a FtsConsistencyTimeoutException  HTTP 200 with execution errors now parses both a JsonArray and a JsonObject. The case where hits is null is also handled.Added unit tests and integration tests most notably for the errorhandling cases.ResultThe error handling of FTS is more correct (and a bug with it is fixed).Other comments from rfc review have been taken into account.,,,
not,Free ByteBufs on get* before filtering them out.MotivationIn all get* variants the results are filtered on nonsuccess. Sincecontent is still allocated in the responses it needs to be properlyfreed before filtering since the later code never has a chance todo so properly.ModificationsFree the allocated contents when the result is filtered out.ResultNo leaks when nonsuccess responses for get* variants are returned.,,,
not,Supporting client changes for JVMCBC430MotivationSet createdocument value in AsyncMutateInBuilder in Single path mutationcommandsChanges Pass the createDocument value to Single path mutation requests in coreResultscreateDocument value is used. Verification tests inSubDocumentDocumentFlagsTests pass.,,,
not,Better NMV handlingMotivationOnce the NMVB collection (set) is full we never reset it backto a clean state. This means that once full the primary nodewill always be used even if it returns NMVB itself multipletimes.Also because of the heuristics in place a NMVB will not triggera config check for a new config. Since this is a clear pointer toan outdated config doing so will get it to a good confing quicker.ModificationsIf the collection is full empty it out. This will make room forsubsequent attempts. Also trigger a \"checkConfigUpdate\" if we needto reschedule such an operation (thresholds in the CF still apply).Also the code makes sure that the alternative node is active. Thisneeds to be in place because it could be that the node in the listhas been removed already but is still hold as a reference in thisset.ResultMore robust handling of NMVB operations.,,,
not,One more spot where to fix the race condition.This changeset also fixes the possible inconsistency in the observePollmethod not only in observe itself.,,,
not,Remove stray Uncomitted markers for Analytics,,,
not,slight repackaging of views.,,,
not,Making sure reconnect logic is not called in parallel.This also prevents the underlying logic to be executed more oftenthan needed and therefore mitigating race conditions and overloadedIO.,,,
not,Retry logic for prepared statements executionMotivation:Execution of queries marked as no adhoc are implemented throughprepared statements and a local cache of execution plans.However such executions should be made more resilient to a few N1QLside errors by repreparing and reexecuting once.Modifications:QueryExecutor's dispatchPrepared now has a retry logic in place. It willpeek into the result of an EXECUTE (in the N1QL sense corresponding tothe executePrepared method) and redo a PREPARE followed by EXECUTE ifthere's a retrywarranting error.This is only done once but is active both if the statement is in cacheor not.QueryExecutor has been reworked in order to allow unit testing. Unittests have been added that verify various scenarios around preparedstatements cache and retry.Results:Non adhoc queries are now retried once when the executed plan isdetermined to be outdated (errors 4050 4070 and some 5000s).QueryExecutor unit tests pass.,,,
not,Upgrade spymemcached to 2.10.4,,,
not,Cluster Level QueryingMotivation:Breaking from the historical model of data manipulation at the bucketlevel N1QL allows to perform JOINS over multiple buckets.Even though it *is* technically possible to perform such a query froma Bucket (by making sure that all relevant credentials other than theones for the root bucket are provided in the N1qlQuery) it is a bitcounterintuitive.Clusterlevel querying aims at providing a more intuitive way of doingsuch bucketspanning queries.Note that the configuration and resource management of the SDK makes itso that performing a N1QL query still has the prerequisite that abucket is currently opened in the Cluster.Modifications:Mirrored the query API from Bucket/AsyncBucket to Cluster/AsyncCluster.The sync version delegates to the AsyncCluster while the async versionattempts to find an open AsyncBucket and delegate the execution of thequery to it. If no open bucket is found the method will error with anUnsupportedOperationException.The query is enriched with the credentials taken from the currentlyconfigured Authenticator. If none are available the query method willerror with an IllegalStateException.The function that allows to go from an AsyncN1qlQueryResult to a syncone has been extracted in N1qlQueryExecutor. It is reused by the queryimplementation in CouchbaseCluster.Results:N1QL queries spanning multiple buckets (including password protectedones) can be more intuitively performed from the Cluster/AsyncCluster.This functionality and its specific error condition (no open bucket)are tested in an integration test.,,,
not,Do not notify ViewFuture listeners twice.This changeset fixes a regression introduced in the latestlistener changes which makes sure to not notify the listenerstwice on the ViewFuture (which is triggered only whensetIncludeDocs(true)),,,
not,Add support for counter and through the LongDocument as a result,,,
not,Fixed ViewQueryTest.java,,,
not,Feed query statement into core for tracing tagMotivationcoreio added support for adding a standard opentracing tag intothe span for n1ql queries so this changeset follows suit to feedthe raw statement into it.ModificationsThe executor now passes the statement in string form down to coreiowhich picks it up and adds it as a span tag if needed.,,,
not,Set the version to 2.0.2SNAPSHOT,,,
not,Implement better Exception names for CacheBucketThis changeset removes ambigous TODO exceptions and exchanges themwith proper ones.,,,
not,Descriptive exception types for bucket (auth) failures.MotivationIn addition to the generic CouchbaseException toplevel exception moredetailed subclasses allow for more descriptive and narrow error handling.ModificationsThis change adds specific exceptions for invalid bucket names and passwordsso that the user can apply custom logic to each of them (probably reportingit differently since in general they are nontransient).ResultEasier error handling for the user.,,,
not,Bump the mock to 1.5.9,,,
not,CouchbaseProperties should use the SPY LoggerFactory.Before this change these log messages were not properlylogged with respect to the configured logging endpoint.Also the informative log message has been degraded toDEBUG because it is not used that often and it generatesconfusion.,,,
not,Fix failing N1QL units tests by changing response parse statusMotivationRetry for failed N1ql prepared query now expects that the http responsestatus is a failure due to the fix for JCBC1029ChangesPreviously the stubbed response had success status as true indicating thestatus code as success even though the query was not successful. Modifiedit as false. ResultsN1ql prepared unit tests pass,,,
not,Prepare 2.1.0dp2 release,,,
not,Remove unused variables in observe implementation,,,
not,Start 2.6.0 Development,,,
not,Releasing 2.0.0beta2,,,
not,Facet name is kept in SearchQueryMotivation:In RFC10 (couchbaselabs/sdkrfcs#17) some SDKs can directly map theobject representation to JSON. In the previous design of facets havingthe name attribute as part of the SearchFacet made that problematic.It has been decided that the name of a facet should only be set on theSearchQuery in which the facet is added (which would also allow reuse offacets across queries with different names).Modifications:SearchFacet has no name attribute anymore moved into the SearchQuery.,,,
not,CouchbaseMock query ping times outMotivationThe previous fix for this issue didn't really fix the DuseMocknot being honored properly.  Seems it still wasn't and this needsto be addressed as part of that fixModificationWe need the pom to properly handle test resources and the filteringfor them.  Also we needed a small change  the original leading backslash  toproperly load the properties file in the first place.,,,
not,Merge current release 1.0 branch fixes in for 1.1.* gerrit/release10:  JCBC120: Fix NPE on null for password. Backport.  JCBC70: Fix Authentication to nondefault bucket when connecting new node,,,
not,Handle EXISTS response on append/prepend.MotivationWhen an append/prepend operation is called with the casvalue set and the requests value does not match with theserver one it will return with an EEXISTS (same as ona replace operation for example).ModificationsThe proper mapping from EXISTS to a CASMismatchExceptionhas been coded as well as adding integration tests toavoid regressions in the future.ResultEXISTS on append/prepend are now properly converted intothe right exception type.,,,
not,Add test case for SPY146.This changeset adds a test case to make sure observe with 2byteUTF8 chars works as expected. To pass this requires at leastspymemcached 2.10.3 in place.,,,
not,Fix integration testsThe jenkins ones in particular they run fine locally.  This tweaksthe python script a bit in hopes of correcting the issues with coretests.,,,
not,Pass RetryStrategy to Observe for fail fast support.,,,
not,Fix hardcoded subdoc counter createDocument value,,,
not,Enable ByteBuf leak detector and log4j logging on tests.MotivationWe need to enable the PARANOID leak detector as well on the client tomake sure we fix all leaks.,,,
not,First commit* Transferred all of the Couchbase code from spymemcached  into this project* Updated build files to properly build the project* Fixed errors in project to allow it to build* Fixed check style errors,,,
not,Align environment changes from the core.,,,
not,Override coreio builder for certAuthEnabled,,,
not,Allow replicateTo without persistToThis changeset makes it possible to run mutation operationslike addsetreplace or cas only with replicateTo set andpersistTo to zero. This adds a security net to operationsthat need to be fast but dont have to be persistet at thesame time.,,,